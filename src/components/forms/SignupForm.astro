---
import Input from "~/components/ui/Input.astro";
import Button from "~/components/ui/Button.astro";
import type { FormErrorType } from "~/types";

interface Props {
  errors?: FormErrorType;
}
const { errors = {} } = Astro.props;
const nameError = errors["name"];
const emailError = errors["email"];
const passError = errors["password"];
const customError = errors["custom"];
---

<form id="signup-form" hx-post="/api/signup" hx-swap="outerHTML">
  <label for="name">Name {nameError && <span class="text-red-600 form-error">{nameError}</span>}</label>
  <Input placeholder="Will Smith" name="name" />
  <br />
  <label for="email">Email {emailError && <span class="text-red-600 form-error">{emailError}</span>}</label>
  <Input placeholder="mail@example.com" name="email" type="text" />
  <br />
  <label for="password">Password {passError && <span class="text-red-600 form-error">{passError}</span>}</label>
  <Input name="password" type="text" />
  <br />
  <Button id="signup-submit-button" name="Create account" type="submit" />
  {customError && <p class="text-red-600 mt-2 form-error">{customError}</p>}
</form>
<script>
  window.htmx?.on("htmx:beforeRequest", (event) => {
    const form = event.target;

    const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;
    document.querySelectorAll(".form-error").forEach((element) => {
      element.remove();
    });
    if (submitButton) {
      submitButton.disabled = true;
      submitButton.innerText = "Submitting...";
    }
  });
</script>
