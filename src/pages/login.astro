---
import Layout from "../components/Layout.astro";
if (Astro.locals.user) {
  return Astro.redirect("/");
}
---

<Layout>
  <main class="max-w-lg mx-auto my-20 p-4">
    <h1 class="text-4xl font-bold mb-4">Sign in</h1>
    <form method="post" action="/api/login">
      <label for="username">Username</label>
      <input
        class="outline-none ring-2 rounded flex w-full ring-gray-400 p-2 focus:ring-indigo-600"
        name="username"
        id="username"
      /><br />
      <label for="password">Password</label>
      <input
        class="outline-none ring-2 rounded flex w-full ring-gray-400 p-2 focus:ring-indigo-600"
        type="password"
        name="password"
        id="password"
      /><br />
      <button
        class="rounded-md bg-indigo-600 text-white p-2 px-8 w-full"
        type="submit">Continue</button
      >
      <p id="form-error"></p>
    </form>
    <p>
      Dont have an account?
      <a
        class="mt-4 text-center underline inline-flex hover:text-indigo-600"
        href="/signup">Create an account</a
      >
    </p>
  </main>
</Layout>
<script>
  const errorMessageElement = document.getElementById("form-error")!;

  document.forms[0].addEventListener("submit", async (e) => {
    e.preventDefault();
    errorMessageElement.innerText = "";
    const formElement = e.target as HTMLFormElement;
    const response = await fetch(formElement.action, {
      method: formElement.method,
      body: new FormData(formElement),
    });
    if (response.ok) {
      window.location.href = "/";
    } else {
      errorMessageElement.innerText = (await response.json()).error;
    }
  });
</script>
